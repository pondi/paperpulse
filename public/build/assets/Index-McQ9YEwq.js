import{r as g,q as E,c as m,a as n,w as y,b as e,d as i,p as l,m as _,t as r,l as h,F as k,e as S,g as O,s as V,u as F,i as C,h as v}from"./app-ifJRh6KD.js";import{_ as L}from"./AuthenticatedLayout-BSqnk0kP.js";import"./ApplicationLogo-MxaaLDVg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./CheckCircleIcon-YUPfUU4_.js";const P={class:"py-12"},q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},K={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6"},R={class:"p-6"},H={class:"flex justify-between items-center"},U=["disabled"],X={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},$={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},I={class:"p-6"},G={class:"flex justify-between items-center mb-4"},J=["disabled"],Q={key:0,class:"text-center py-8 text-gray-500"},W={key:1,class:"overflow-x-auto"},Y={class:"min-w-full divide-y divide-gray-200"},Z={class:"bg-gray-50"},ee={class:"px-6 py-3 text-left"},te=["checked"],se={class:"bg-white divide-y divide-gray-200"},oe={class:"px-6 py-4 whitespace-nowrap"},ne=["value"],ae={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},le={class:"px-6 py-4 whitespace-nowrap"},de={key:0,class:"block text-xs text-red-600 mt-1"},ce={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ue=["onClick"],ge={key:2,class:"mt-4"},pe={class:"flex justify-center"},ve={__name:"Index",props:{files:Object},setup(d){const A=d,c=g(!1),u=g(""),p=g(!1),x=g(!1),a=g([]),f=E(()=>A.files.data.filter(s=>b(s))),b=s=>["pending","failed"].includes(s.status),j=s=>{s.target.checked?a.value=f.value.map(t=>t.id):a.value=[]},M=async()=>{c.value=!0,u.value="";try{const s=await fetch(route("pulsedav.sync"),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}),t=await s.json();p.value=s.ok,u.value=t.message,s.ok&&t.synced>0&&v.reload()}catch{p.value=!1,u.value="Failed to sync files. Please try again."}finally{c.value=!1}},T=async()=>{if(a.value.length!==0){x.value=!0;try{const s=await fetch(route("pulsedav.process"),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({file_ids:a.value})}),t=await s.json();s.ok&&(a.value=[],v.reload())}catch(s){console.error("Failed to process files:",s)}finally{x.value=!1}}},N=async s=>{if(confirm(`Are you sure you want to delete ${s.filename}?`))try{(await fetch(route("pulsedav.destroy",s.id),{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"}})).ok&&v.reload()}catch(t){console.error("Failed to delete file:",t)}},B=s=>{if(!s)return"N/A";const t=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(1024));return Math.round(s/Math.pow(1024,o)*100)/100+" "+t[o]},D=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",z=s=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800";return(s,t)=>(n(),m(L,null,{header:y(()=>t[1]||(t[1]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Scanner Imports (PulseDav) ",-1)])),default:y(()=>[e("div",P,[e("div",q,[e("div",K,[e("div",R,[e("div",H,[t[3]||(t[3]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900"},"Sync Scanner Files"),e("p",{class:"mt-1 text-sm text-gray-600"}," Check for new files uploaded by your scanner ")],-1)),e("button",{onClick:M,disabled:c.value,class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 focus:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150 disabled:opacity-50"},[c.value?(n(),i("svg",X,t[2]||(t[2]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):l("",!0),_(" "+r(c.value?"Syncing...":"Sync Files"),1)],8,U)]),u.value?(n(),i("div",{key:0,class:h(["mt-4 p-4 rounded-md",p.value?"bg-green-50 text-green-800":"bg-red-50 text-red-800"])},r(u.value),3)):l("",!0)])]),e("div",$,[e("div",I,[e("div",G,[t[4]||(t[4]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Scanner Files",-1)),a.value.length>0?(n(),i("button",{key:0,onClick:T,disabled:x.value,class:"inline-flex items-center px-4 py-2 bg-green-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-green-700 focus:bg-green-700 active:bg-green-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition ease-in-out duration-150 disabled:opacity-50"}," Process "+r(a.value.length)+" File"+r(a.value.length>1?"s":""),9,J)):l("",!0)]),d.files.data.length===0?(n(),i("div",Q,' No files found. Click "Sync Files" to check for new scanner uploads. ')):(n(),i("div",W,[e("table",Y,[e("thead",Z,[e("tr",null,[e("th",ee,[e("input",{type:"checkbox",onChange:j,checked:a.value.length===f.value.length&&f.value.length>0,class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,40,te)]),t[5]||(t[5]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Filename ",-1)),t[6]||(t[6]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Size ",-1)),t[7]||(t[7]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Uploaded ",-1)),t[8]||(t[8]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ",-1)),t[9]||(t[9]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ",-1))])]),e("tbody",se,[(n(!0),i(k,null,S(d.files.data,o=>(n(),i("tr",{key:o.id},[e("td",oe,[b(o)?O((n(),i("input",{key:0,type:"checkbox",value:o.id,"onUpdate:modelValue":t[0]||(t[0]=w=>a.value=w),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,8,ne)),[[V,a.value]]):l("",!0)]),e("td",ae,r(o.filename),1),e("td",ie,r(B(o.size)),1),e("td",re,r(D(o.uploaded_at)),1),e("td",le,[e("span",{class:h(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",z(o.status)])},r(o.status),3),o.error_message?(n(),i("span",de,r(o.error_message),1)):l("",!0)]),e("td",ce,[o.receipt_id?(n(),m(F(C),{key:0,href:s.route("receipts.show",o.receipt_id),class:"text-indigo-600 hover:text-indigo-900 mr-3"},{default:y(()=>t[10]||(t[10]=[_(" View Receipt ")])),_:2},1032,["href"])):l("",!0),e("button",{onClick:w=>N(o),class:"text-red-600 hover:text-red-900"}," Delete ",8,ue)])]))),128))])])])),d.files.links.length>3?(n(),i("div",ge,[e("nav",pe,[(n(!0),i(k,null,S(d.files.links,o=>(n(),m(F(C),{key:o.label,href:o.url,class:h(["px-3 py-2 mx-1 text-sm font-medium rounded-md",o.active?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-50",!o.url&&"cursor-not-allowed opacity-50"]),innerHTML:o.label,disabled:!o.url},null,8,["href","class","innerHTML","disabled"]))),128))])])):l("",!0)])])])])]),_:1}))}};export{ve as default};
